<!DOCTYPE html>
<html lang="da">
<head>
  <meta charset="UTF-8">
  <title>Mix Selv - Din drink bliver lavet</title>
  <link rel="stylesheet" href="../CSS/MainStyle.css">
  <link rel="stylesheet" href="../CSS/ButtonStyle.css">
  <link rel="stylesheet" href="../CSS/progress.css">
</head>
<body>
<div class="bg">
  <div class="overlay">
    <div class="container">
      <h1>Din drink mixes...</h1>
      <h2 id="drinkTitle"></h2>
      <ul id="ingredientList"></ul>
      <p id="stepInfo"></p>
      <button onclick="window.location.href='index.html'">Tilbage til forsiden</button>
    </div>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function () {
    const drinkName = sessionStorage.getItem("drinkName") || "Ukendt Drink";
    const ingredients = JSON.parse(sessionStorage.getItem("selectedIngredients") || "[]");

    document.getElementById("drinkTitle").innerText = "Mix Selv: " + drinkName;

    const ul = document.getElementById("ingredientList");
    ingredients.forEach((ingredient, index) => {
        if (ingredient === "Ingen") return;
        const li = document.createElement("li");
        li.innerText = (index + 1) + ". " + ingredient;
        ul.appendChild(li);
    });

    document.getElementById("stepInfo").innerText = `Der mixes ${ingredients.length} trin...`;
});

function pollRobotStatus() {
    fetch('http://localhost:5001/robot_status')
        .then(res => res.json())
        .then(data => {
            if (!data.running) {
                console.log("Robot er færdig! Går til forsiden...");
                window.location.href = "index.html";
            } else {
                console.log("Robot stadig i gang...");
                setTimeout(pollRobotStatus, 3000); // Prøv igen om 3 sekunder
            }
        })
        .catch(err => {
            console.error("Fejl ved status-tjek:", err);
            setTimeout(pollRobotStatus, 3000);
        });
}

// Start polling efter 2 sekunder
setTimeout(pollRobotStatus, 2000);

</script>
</body>
</html>